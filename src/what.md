# mirakcって何ですか？

初めて名前を目にした人もいると思うので，簡単に説明しておきます．

mirakcは，Raspberry Piのような[シングルボードコンピュータ]（SBC）をターゲットデバ
イスとして，Rust言語で記述されたMirakurunクローンです．

大きな改善点として，CPU使用率及びメモリー使用量の改善が挙げられます．例えば，８
チャンネル同時ストリーミング時のリソース使用効率が，Mirakurunと比べて以下のよう
に向上しています．

* CPU使用率は2/3
* メモリー使用量は1/60

また，GCを使用しない実装となっていることから（一部，参照カウント方式のメモリー管
理を行っています），CPU使用率・メモリー使用量共に安定的に推移します．

mirakcは，Mirakurunの完全クローンには至っておらず，EPGStationを動作させるために
必要な[Web API]のみを実装しています．そのため，残念ながらChinachuでは使えません
（もちろん，不足しているWeb APIを実装すれば動くとは思います）．

## 開発を始めるまでの経緯

一般的に，SBCは以下のような特徴を持っています．

* 1GHz程度の低クロックCPU
* 1GB程度のメモリー
* 十数ワットの電力消費

一昔前のデスクトップPCよりも貧弱な環境です．動画をffmpegでソフトウェアエンコード
するといった使い方には向いていません．しかし，２４時間稼働し続けるちょっとしたサ
ービスの運用には最適です．

ちょっとしたサービス．そう，録画サーバーに向いていると思いませんか？私もそう考え
て，棚の上で埃を被っていたRaspberry Pi 3Bに手を伸ばしました．

早速メルカリでPX-S1UDとカードリーダーを手に入れました．マイクロSDカードに
Raspbianを書き込み，チューナーデバイスのファームウェアとMirakurunをインストール
しました．

Mirakurunは申し分ない速度で動作しました．CPU使用率も問題ありませんでした．心配
していたメモリー使用量は150MB前後であり，予想よりも少ない消費量で動作しました．
ちょっとした成功に高揚感を感じた私は，何を思ったのか[ROCK64]とPX-Q3U4を購入して
いました．

当時（２０１９年第１四半期），Raspberry Pi 3Bに搭載されているイーサネットの上限
が100Mbpsであるため，Mirakurunで４つのTSストリームを同時に送信することは困難であ
ることが知られていました（Qiitaの記事だったと記憶していますが，その記事はすでに
削除されてしまっているようです）．そこで，ROCK64の登場です．今ならRaspberry Pi 4
を購入する場面ですが，その当時，1Gbpsイーサネット搭載で扱いやすそうなSBCの１つが
ROCK64でした．価格も手頃だったので悩むことなく購入しました．

準備を整え，８つのTSストリームの同時送信を試したところ，メモリーが枯渇しました．
後で分かったことですが，Mirakurunでも2GBあれば８つのTSストリームを同時送信可能で
す．当時私が使用していたROCK64に搭載されていたメモリーは1GB．ROCK64のメモリーの
ラインナップ1/2/4GB．数千円をケチって安いのを買ったことがmirakc開発の始まりとな
りました．

[シングルボードコンピュータ]: https://ja.wikipedia.org/wiki/%E3%82%B7%E3%83%B3%E3%82%B0%E3%83%AB%E3%83%9C%E3%83%BC%E3%83%89%E3%82%B3%E3%83%B3%E3%83%94%E3%83%A5%E3%83%BC%E3%82%BF
[Web API]: https://github.com/mirakc/mirakc/blob/main/docs/web-api.md
[ROCK64]: https://wiki.pine64.org/index.php/ROCK64
